# DNSWatcher - DNS Security Monitoring Application

## Project Overview
DNSWatcher is a proof-of-concept web application for DNS security monitoring. It's built with modern web technologies to provide a simple yet effective way to monitor DNS zones for changes and notify users when their domains' SOA records change.

## Repository Information
- **Organization**: Axon-Shield
- **Repository**: DNSWatcher
- **URL**: https://github.com/Axon-Shield/DNSWatcher
- **Status**: ✅ Fully deployed and operational
- **Commits**: 12 commits with conventional commit messages
- **Branch**: main (production-ready)

## Tech Stack
- **Framework**: Next.js 14+ with App Router
- **Language**: TypeScript
- **Frontend**: React 18+
- **UI Components**: shadcn/ui + Radix UI primitives
- **Styling**: Tailwind CSS
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **Backend**: Supabase Edge Functions (Deno)
- **Automation**: pg_cron for scheduled tasks
- **Email**: Supabase Edge Functions
- **Version Control**: GitHub MCP integration

## Project Structure
```
src/
├── app/                    # Next.js App Router
│   ├── (auth)/            # Auth-related pages
│   ├── api/               # API routes (proxy to Edge Functions)
│   │   ├── auth/          # Authentication endpoints
│   │   ├── zones/         # DNS zone management
│   │   └── webhooks/      # External webhooks
│   ├── dashboard/         # User dashboard
│   ├── globals.css        # Global styles
│   ├── layout.tsx         # Root layout
│   └── page.tsx           # Homepage (brochureware)
├── components/            # Reusable UI components
│   ├── ui/               # shadcn/ui components
│   ├── forms/            # Form components
│   └── layout/           # Layout components
├── lib/                  # Utility functions
│   ├── supabase.ts       # Supabase client
│   ├── supabase-client.ts # Browser client
│   ├── supabase-server.ts # Server client
│   └── utils.ts         # General utilities
├── types/               # TypeScript type definitions
└── hooks/               # Custom React hooks
docs/                    # Documentation files
context/                 # Context files for AI understanding
```

## CRITICAL: Automatic Git Commit Rules

### MANDATORY COMMIT BEHAVIOR
**When ANY code changes are made and accepted by the user, the LLM MUST:**

1. **ALWAYS commit changes immediately** using `run_terminal_cmd` with git commands
2. **Use descriptive conventional commit messages** following the patterns below
3. **Never leave changes uncommitted** - every code change must be pushed to GitHub
4. **Update context files** if documentation needs updating
5. **Test changes** before committing when possible

### AUTOMATIC COMMIT TRIGGERS
**The LLM must commit and push to GitHub when:**
- ✅ User accepts any code changes
- ✅ New features are implemented
- ✅ Bug fixes are applied
- ✅ Documentation is updated
- ✅ Configuration files are modified
- ✅ Dependencies are added or updated
- ✅ Any file is created, modified, or deleted

### GIT COMMAND PATTERNS (MANDATORY)
**Use these git commands via `run_terminal_cmd`:**
- `git add .` - Stage all changes
- `git commit -m "feat(ui): add new component"` - Commit with conventional message
- `git push origin main` - Push to GitHub repository

### COMMIT MESSAGE PATTERNS (MANDATORY)
- **Frontend**: `feat(ui): add new component` or `fix(ui): resolve styling issue`
- **Backend**: `feat(api): add new endpoint` or `fix(api): resolve edge function error`
- **Database**: `feat(db): add new table` or `fix(db): resolve migration issue`
- **DNS**: `feat(dns): add monitoring feature` or `fix(dns): resolve SOA detection`
- **Email**: `feat(email): add notification service` or `fix(email): resolve delivery issue`
- **Docs**: `docs: update setup guide` or `docs: add new context file`
- **Refactor**: `refactor: clean up unused files` or `refactor: improve code structure`
- **Chore**: `chore: update dependencies` or `chore: maintenance task`

## File Access Rules

### LOCAL FILE ACCESS (PREFERRED)
**When viewing or reading file contents, ALWAYS use:**
- `read_file` tool for local file access
- `list_dir` tool for directory listings
- `glob_file_search` tool for file searches
- **NEVER use GitHub MCP for reading local files**

### GitHub MCP Usage (ADVANCED OPERATIONS ONLY)
**Use GitHub MCP tools ONLY for operations NOT available via git command line:**
- `mcp_github_create_pull_request` - Creating pull requests
- `mcp_github_create_issue` - Creating issues
- `mcp_github_search_code` - Searching code across repositories
- `mcp_github_list_commits` - Listing commits with advanced filtering
- `mcp_github_get_commit` - Getting detailed commit information
- **NOT for basic commits/pushes** - Use git command line instead

## Context-Aware Development Rules

### Backend/Server Features
**Keywords**: "backend", "server", "API", "database", "cron", "automation", "edge function"
**Auto-actions**:
1. Use Supabase Edge Functions for all server logic
2. Use Supabase MCP tools for database operations
3. Use pg_cron for scheduled tasks
4. Deploy functions immediately with mcp_supabase_deploy_edge_function
5. Update context files in context/ folder
6. **MANDATORY**: Use git commands via `run_terminal_cmd` with descriptive commit message

### Frontend/UI Features  
**Keywords**: "frontend", "UI", "component", "page", "form", "styling", "react"
**Auto-actions**:
1. Create Next.js components in src/components/
2. Use shadcn/ui for UI components
3. Use Tailwind CSS for styling
4. Follow App Router patterns
5. Update context files in context/ folder
6. **MANDATORY**: Use git commands via `run_terminal_cmd` with descriptive commit message

### Database/Schema Changes
**Keywords**: "database", "schema", "table", "migration", "RLS", "sql"
**Auto-actions**:
1. Use mcp_supabase_apply_migration for all database changes
2. Never write direct SQL files
3. Always enable RLS on new tables
4. Create proper indexes for performance
5. Update context files in context/ folder
6. **MANDATORY**: Use git commands via `run_terminal_cmd` with descriptive commit message

### DNS/Monitoring Features
**Keywords**: "DNS", "monitoring", "SOA", "alert", "notification", "zone"
**Auto-actions**:
1. Update Edge Function logic in dns-monitor function
2. Modify cron job schedules if needed
3. Update monitoring context
4. Test with real DNS queries
5. Update context files in context/ folder
6. **MANDATORY**: Use git commands via `run_terminal_cmd` with descriptive commit message

### Email/Notification Features
**Keywords**: "email", "notification", "alert", "SMTP", "send"
**Auto-actions**:
1. Update send-email Edge Function
2. Integrate with email service providers
3. Test email delivery
4. Update notification context
5. Update context files in context/ folder
6. **MANDATORY**: Use git commands via `run_terminal_cmd` with descriptive commit message

### Git Integration Rules (CRITICAL)
**Keywords**: "commit", "git", "version control", "push", "pull request"
**Auto-actions**:
1. **MANDATORY**: Always commit changes after implementing features
2. **MANDATORY**: Use descriptive commit messages following conventional commits
3. **MANDATORY**: Use git commands via `run_terminal_cmd` for ALL commits
4. **MANDATORY**: Never leave changes uncommitted
5. **MANDATORY**: Update context files when documentation changes
6. **MANDATORY**: Test changes before committing when possible

### Documentation Updates
**Keywords**: "docs", "documentation", "readme", "context", "guide"
**Auto-actions**:
1. Update relevant documentation files
2. Update context files in context/ folder
3. Ensure accuracy of all information
4. **MANDATORY**: Use git commands via `run_terminal_cmd` with `docs:` prefix
5. **MANDATORY**: Commit documentation changes immediately

## Supabase Integration Details
- **Project URL**: https://ipdbzqiypnvkgpgnsyva.supabase.co
- **Anon Key**: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZGJ6cWl5cG52a2dwZ25zeXZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwMDcyMzYsImV4cCI6MjA3NjU4MzIzNn0.DnoH8NEp1CWGj4qQ4ow8x_HiFp7XC_PglS8pQb3ICVU
- **Edge Functions**: dns-monitor, send-email (both active)
- **Cron Jobs**: dns-monitor-job (every 5 minutes)
- **RLS**: Enabled on all tables

## Key Features
1. **Brochureware Homepage**: Educational content about DNS security
2. **User Registration**: Email + DNS zone registration
3. **DNS Monitoring**: Background task checking SOA records every 5 minutes
4. **Email Notifications**: Alert users when DNS zones change
5. **Dashboard**: User management interface

## Database Schema (Supabase)
- **users**: User accounts and preferences
- **dns_zones**: Monitored DNS zones
- **zone_checks**: Historical SOA record checks
- **notifications**: Sent notification logs

## Development Guidelines
- Use TypeScript strictly with proper type definitions
- Follow Next.js App Router conventions
- Implement proper error handling and loading states
- Use shadcn/ui components for consistent UI
- Write clean, documented code
- Implement proper security measures for DNS operations
- Use environment variables for sensitive configuration
- Always use Supabase MCP tools for database operations
- Deploy Edge Functions immediately when created
- Update context files for new features
- **MANDATORY**: Always commit changes with descriptive messages immediately
- **PREFER LOCAL FILE ACCESS**: Use read_file instead of GitHub MCP for viewing files

## Frontend Debugging & Testing Guidelines

### Browser Debugging Setup
When testing the application locally, always use Edge browser with a dedicated debugging profile:

```powershell
# Create and start Edge with dedicated debugging profile
Start-Process "msedge.exe" -ArgumentList "--user-data-dir=C:\Users\deanc\AppData\Local\Microsoft\Edge\User Data\DebugProfile", "--profile-directory=DebugProfile", "--remote-debugging-port=9222", "--new-window", "http://localhost:3000"

# Verify debugging port is active
netstat -ano | findstr :9222
```

### JavaScript Log Retrieval Commands
Use these PowerShell commands to retrieve browser logs and debug information:

#### 1. Get Browser Tabs and Debug Info
```powershell
# Get all browser tabs with debugging info
Invoke-RestMethod -Uri "http://localhost:9222/json" | ConvertTo-Json -Depth 3
```

#### 2. Test Application Status
```powershell
# Test if application is running
try { 
    $response = Invoke-WebRequest -Uri http://localhost:3000 -UseBasicParsing
    Write-Host "Status: $($response.StatusCode) - Content Length: $($response.Content.Length)"
} catch { 
    Write-Host "Error: $($_.Exception.Message)" 
}
```

#### 3. Test API Endpoints
```powershell
# Test registration API
$body = @{email="test@example.com"; dnsZone="example.com"} | ConvertTo-Json
try { 
    $response = Invoke-WebRequest -Uri http://localhost:3000/api/register -Method POST -Body $body -ContentType "application/json" -UseBasicParsing
    Write-Host "API Status: $($response.StatusCode)"
    Write-Host "Response: $($response.Content)"
} catch { 
    Write-Host "API Error: $($_.Exception.Message)"
}
```

#### 4. Check CSS and Static Assets
```powershell
# Test CSS loading
try { 
    $response = Invoke-WebRequest -Uri "http://localhost:3000/_next/static/css/app/layout.css" -UseBasicParsing
    Write-Host "CSS Status: $($response.StatusCode)"
} catch { 
    Write-Host "CSS Error: $($_.Exception.Message)"
}
```

#### 5. Monitor Development Server
```powershell
# Check if dev server is running
netstat -ano | findstr :3000

# Check Node.js processes
Get-Process | Where-Object {$_.ProcessName -eq "node"}
```

### Common Frontend Issues & Solutions

#### CSS 404 Errors
- **Symptom**: CSS files returning 404 errors
- **Solution**: 
  ```powershell
  # Clean and restart
  taskkill /F /IM node.exe
  Remove-Item -Recurse -Force .next -ErrorAction SilentlyContinue
  npm run dev
  ```

#### JavaScript Import Errors
- **Symptom**: `twMerge is not defined` or similar import errors
- **Solution**: Check `src/lib/utils.ts` for proper imports:
  ```typescript
  import { clsx, type ClassValue } from "clsx"
  import { twMerge } from "tailwind-merge"
  ```

#### Database Schema Errors
- **Symptom**: `Could not find column` errors
- **Solution**: Use Supabase MCP to add missing columns:
  ```sql
  ALTER TABLE users ADD COLUMN notification_preferences JSONB DEFAULT '{"email_enabled": true, "frequency": "immediate"}'::jsonb;
  ```

### Testing Workflow
1. **Start Development Server**: `npm run dev`
2. **Start Browser with Debugging**: Use the Edge command above
3. **Test Application**: Navigate to `http://localhost:3000`
4. **Check Console Logs**: Use browser DevTools or PowerShell commands
5. **Test Registration Form**: Submit test data and monitor API calls
6. **Verify CSS Loading**: Check for 404 errors on static assets
7. **Monitor Network Requests**: Use browser DevTools Network tab

### Debugging Checklist
- [ ] Development server running on port 3000
- [ ] Edge browser with remote debugging on port 9222
- [ ] Application loads with 200 status code
- [ ] CSS files loading without 404 errors
- [ ] JavaScript console free of errors
- [ ] Registration form submits successfully
- [ ] API endpoints return expected responses
- [ ] Database schema matches application requirements

## Security Considerations
- Validate DNS zone inputs
- Implement rate limiting for API endpoints
- Secure email handling
- Protect against DNS enumeration attacks
- Implement proper authentication and authorization
- Use Row Level Security (RLS) for data protection

## Performance
- Optimize DNS queries to avoid overwhelming DNS servers
- Implement caching for DNS responses
- Use efficient background job processing
- Optimize database queries
- Use Supabase Edge Functions for serverless scaling

## Testing
- Unit tests for utility functions
- Integration tests for API endpoints
- E2E tests for critical user flows
- DNS monitoring accuracy tests
- Edge Function testing via Supabase logs

## File Organization Rules
- **Documentation**: Always in docs/ folder
- **Context**: Always in context/ folder  
- **Code**: Follow Next.js App Router structure
- **Database**: Use Supabase MCP tools only
- **Functions**: Deploy to Supabase Edge Functions
- **Version Control**: Always commit changes with git command line
- **File Reading**: Use local read_file tool, NOT GitHub MCP
- **Never**: Write direct SQL files or use external cron services

## Current Status
- ✅ **Project Setup**: Complete Next.js 14 application
- ✅ **Database Schema**: Created and secured with RLS
- ✅ **Edge Functions**: Deployed and active
- ✅ **Cron Jobs**: Configured for automated monitoring
- ✅ **Frontend Application**: Built and functional
- ✅ **GitHub Integration**: MCP integration operational
- ✅ **Documentation**: Complete setup and development guides
- ✅ **Context Files**: AI understanding files created
- ⏳ **Email Service**: Ready for SMTP integration

## Development Workflow
- **Context-Aware**: Automatic tool selection based on feature type
- **Git Command Line**: Automatic commits with descriptive messages
- **Supabase MCP**: Database operations and Edge Function deployment
- **Conventional Commits**: Standardized commit message format
- **Documentation**: Always updated with new features
- **MANDATORY COMMITS**: Every code change must be committed immediately
- **LOCAL FILE ACCESS**: Use read_file for viewing files, git command line for commits